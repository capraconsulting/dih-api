## circle.yml
machine:
    environment:
        PG_URL: postgres://ubuntu:@127.0.0.1:5432/circle_test
    services:
        - docker
dependencies:
    pre:
        - npm install

test:
    override:
        - npm test

deployment:
    prod:
        branch: master
        commands:
            - docker build -t dih/api-production .
            - docker login  $EXTERNAL_REGISTRY
            - docker push dih/api-production
    staging:
        branch: dev
        commands:
            - docker build -t dih/api-dev .
            - docker login  $EXTERNAL_REGISTRY
            - docker push dih/api-dev
